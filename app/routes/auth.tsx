import { NextResponse } from 'next/server';\nimport { verifyAuth0Token } from '../../../config/auth';\n\nexport function GET(request: Request) {\n  const { email } = request.query;\n\n  if (!email) {\n    return NextResponse.json({ error: 'Please provide an email' }, { status: 400 });\n  }\n\n  // Get the Auth0 token for the provided email\n  return verifyAuth0Token(email)\n    .then(async ({ isAuth0Token, payload }) => {\n      if (!isAuth0Token) {\n        return NextResponse.json({ error: 'Invalid email or SMS verification failed' }, { status: 400 });\n      }\n\n      // Create a session and redirect back to the application\n      const session = {\n        userId: payload.user_id,\n        tokenVersion: payload.token_version,\n      };\n\n      return NextResponse.redirect(\n        `/auth/success?session_id=${process.env.AUTH0_SESSION_ID || ''}`\n      );\n    })\n    .catch(error => {\n      console.error('Authentication error:', error);\n      return NextResponse.json({ error: 'An error occurred during authentication' }, { status: 500 });\n    });\n}\n
